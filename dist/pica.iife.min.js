var pica=(()=>{var $=Object.create;var z=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var Y=(H=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(H,{get:(P,L)=>(typeof require!="undefined"?require:P)[L]}):H)(function(H){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+H+'" is not supported')});var ae=(H,P)=>()=>(P||H((P={exports:{}}).exports,P),P.exports),ie=(H,P)=>{for(var L in P)z(H,L,{get:P[L],enumerable:!0})},X=(H,P,L,C)=>{if(P&&typeof P=="object"||typeof P=="function")for(let Q of te(P))!Ae.call(H,Q)&&Q!==L&&z(H,Q,{get:()=>P[Q],enumerable:!(C=ee(P,Q))||C.enumerable});return H};var ne=(H,P,L)=>(L=H!=null?$(re(H)):{},X(P||!H||!H.__esModule?z(L,"default",{value:H,enumerable:!0}):L,H)),se=H=>X(z({},"__esModule",{value:!0}),H);var Z=ae((J,N)=>{(function(H){if(typeof J=="object"&&typeof N!="undefined")N.exports=H();else if(typeof define=="function"&&define.amd)define([],H);else{var P;typeof window!="undefined"?P=window:typeof global!="undefined"?P=global:typeof self!="undefined"?P=self:P=this,P.pica=H()}})(function(){var H,P,L;return(function(){function C(Q,S,E){function B(i,s){if(!S[i]){if(!Q[i]){var e=typeof Y=="function"&&Y;if(!s&&e)return e(i,!0);if(a)return a(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}var l=S[i]={exports:{}};Q[i][0].call(l.exports,function(n){var o=Q[i][1][n];return B(o||n)},l,l.exports,C,Q,S,E)}return S[i].exports}for(var a=typeof Y=="function"&&Y,A=0;A<E.length;A++)B(E[A]);return B}return C})()({1:[function(C,Q,S){"use strict";var E=C("multimath"),B=C("./mm_unsharp_mask"),a=C("./mm_resize");function A(i){var s=i||[],e={js:s.indexOf("js")>=0,wasm:s.indexOf("wasm")>=0};E.call(this,e),this.features={js:e.js,wasm:e.wasm&&this.has_wasm()},this.use(B),this.use(a)}A.prototype=Object.create(E.prototype),A.prototype.constructor=A,A.prototype.resizeAndUnsharp=function(s,e){var t=this.resize(s,e);return s.unsharpAmount&&this.unsharp_mask(t,s.toWidth,s.toHeight,s.unsharpAmount,s.unsharpRadius,s.unsharpThreshold),t},Q.exports=A},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(C,Q,S){"use strict";function E(e){return e<0?0:e>255?255:e}function B(e){return e>=0?e:0}function a(e,t,l,n,o,u){var h,I,v,m,b,y,F,d,p,x,w,G=0,D=0;for(p=0;p<n;p++){for(b=0,x=0;x<o;x++){for(y=u[b++],F=u[b++],d=G+y*4|0,h=I=v=m=0;F>0;F--)w=u[b++],m=m+w*e[d+3]|0,v=v+w*e[d+2]|0,I=I+w*e[d+1]|0,h=h+w*e[d]|0,d=d+4|0;t[D+3]=B(m>>7),t[D+2]=B(v>>7),t[D+1]=B(I>>7),t[D]=B(h>>7),D=D+n*4|0}D=(p+1)*4|0,G=(p+1)*l*4|0}}function A(e,t,l,n,o,u){var h,I,v,m,b,y,F,d,p,x,w,G=0,D=0;for(p=0;p<n;p++){for(b=0,x=0;x<o;x++){for(y=u[b++],F=u[b++],d=G+y*4|0,h=I=v=m=0;F>0;F--)w=u[b++],m=m+w*e[d+3]|0,v=v+w*e[d+2]|0,I=I+w*e[d+1]|0,h=h+w*e[d]|0,d=d+4|0;h>>=7,I>>=7,v>>=7,m>>=7,t[D+3]=E(m+8192>>14),t[D+2]=E(v+8192>>14),t[D+1]=E(I+8192>>14),t[D]=E(h+8192>>14),D=D+n*4|0}D=(p+1)*4|0,G=(p+1)*l*4|0}}function i(e,t,l,n,o,u){var h,I,v,m,b,y,F,d,p,x,w,G,D=0,W=0;for(x=0;x<n;x++){for(y=0,w=0;w<o;w++){for(F=u[y++],d=u[y++],p=D+F*4|0,h=I=v=m=0;d>0;d--)G=u[y++],b=e[p+3],m=m+G*b|0,v=v+G*e[p+2]*b|0,I=I+G*e[p+1]*b|0,h=h+G*e[p]*b|0,p=p+4|0;v=v/255|0,I=I/255|0,h=h/255|0,t[W+3]=B(m>>7),t[W+2]=B(v>>7),t[W+1]=B(I>>7),t[W]=B(h>>7),W=W+n*4|0}W=(x+1)*4|0,D=(x+1)*l*4|0}}function s(e,t,l,n,o,u){var h,I,v,m,b,y,F,d,p,x,w,G=0,D=0;for(p=0;p<n;p++){for(b=0,x=0;x<o;x++){for(y=u[b++],F=u[b++],d=G+y*4|0,h=I=v=m=0;F>0;F--)w=u[b++],m=m+w*e[d+3]|0,v=v+w*e[d+2]|0,I=I+w*e[d+1]|0,h=h+w*e[d]|0,d=d+4|0;h>>=7,I>>=7,v>>=7,m>>=7,m=E(m+8192>>14),m>0&&(h=h*255/m|0,I=I*255/m|0,v=v*255/m|0),t[D+3]=m,t[D+2]=E(v+8192>>14),t[D+1]=E(I+8192>>14),t[D]=E(h+8192>>14),D=D+n*4|0}D=(p+1)*4|0,G=(p+1)*l*4|0}}Q.exports={convolveHor:a,convolveVert:A,convolveHorWithPre:i,convolveVertWithPre:s}},{}],3:[function(C,Q,S){"use strict";Q.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEYA2AGf39/f39/AGAAAGAIf39/f39/f38AAg8BA2VudgZtZW1vcnkCAAADBwYBAAAAAAIGBgF/AEEACweUAQgRX193YXNtX2NhbGxfY3RvcnMAAAtjb252b2x2ZUhvcgABDGNvbnZvbHZlVmVydAACEmNvbnZvbHZlSG9yV2l0aFByZQADE2NvbnZvbHZlVmVydFdpdGhQcmUABApjb252b2x2ZUhWAAUMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAKyA4GAwABC4wDARB/AkAgA0UNACAERQ0AIANBAnQhFQNAQQAhE0EAIQsDQCALQQJqIQcCfyALQQF0IAVqIgYuAQIiC0UEQEEAIQhBACEGQQAhCUEAIQogBwwBCyASIAYuAQBqIQhBACEJQQAhCiALIRRBACEOIAchBkEAIQ8DQCAFIAZBAXRqLgEAIhAgACAIQQJ0aigCACIRQRh2bCAPaiEPIBFB/wFxIBBsIAlqIQkgEUEQdkH/AXEgEGwgDmohDiARQQh2Qf8BcSAQbCAKaiEKIAhBAWohCCAGQQFqIQYgFEEBayIUDQALIAlBB3UhCCAKQQd1IQYgDkEHdSEJIA9BB3UhCiAHIAtqCyELIAEgDEEBdCIHaiAIQQAgCEEAShs7AQAgASAHQQJyaiAGQQAgBkEAShs7AQAgASAHQQRyaiAJQQAgCUEAShs7AQAgASAHQQZyaiAKQQAgCkEAShs7AQAgDCAVaiEMIBNBAWoiEyAERw0ACyANQQFqIg0gAmwhEiANQQJ0IQwgAyANRw0ACwsL2gMBD38CQCADRQ0AIARFDQAgAkECdCEUA0AgCyEMQQAhE0EAIQIDQCACQQJqIQYCfyACQQF0IAVqIgcuAQIiAkUEQEEAIQhBACEHQQAhCkEAIQkgBgwBCyAHLgEAQQJ0IBJqIQhBACEJIAIhCkEAIQ0gBiEHQQAhDkEAIQ8DQCAFIAdBAXRqLgEAIhAgACAIQQF0IhFqLwEAbCAJaiEJIAAgEUEGcmovAQAgEGwgDmohDiAAIBFBBHJqLwEAIBBsIA9qIQ8gACARQQJyai8BACAQbCANaiENIAhBBGohCCAHQQFqIQcgCkEBayIKDQALIAlBB3UhCCANQQd1IQcgDkEHdSEKIA9BB3UhCSACIAZqCyECIAEgDEECdGogB0GAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQQh0QYD+A3EgCUGAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQRB0QYCA/AdxIApBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG3I2AgAgAyAMaiEMIBNBAWoiEyAERw0ACyAUIAtBAWoiC2whEiADIAtHDQALCwuSAwEQfwJAIANFDQAgBEUNACADQQJ0IRUDQEEAIRNBACEGA0AgBkECaiEIAn8gBkEBdCAFaiIGLgECIgdFBEBBACEJQQAhDEEAIQ1BACEOIAgMAQsgEiAGLgEAaiEJQQAhDkEAIQ1BACEMIAchFEEAIQ8gCCEGA0AgBSAGQQF0ai4BACAAIAlBAnRqKAIAIhBBGHZsIhEgD2ohDyARIBBBEHZB/wFxbCAMaiEMIBEgEEEIdkH/AXFsIA1qIQ0gESAQQf8BcWwgDmohDiAJQQFqIQkgBkEBaiEGIBRBAWsiFA0ACyAPQQd1IQkgByAIagshBiABIApBAXQiCGogDkH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEECcmogDUH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEEcmogDEH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEGcmogCUEAIAlBAEobOwEAIAogFWohCiATQQFqIhMgBEcNAAsgC0EBaiILIAJsIRIgC0ECdCEKIAMgC0cNAAsLC4IEAQ9/AkAgA0UNACAERQ0AIAJBAnQhFANAIAshDEEAIRJBACEHA0AgB0ECaiEKAn8gB0EBdCAFaiICLgECIhNFBEBBACEIQQAhCUEAIQYgCiEHQQAMAQsgAi4BAEECdCARaiEJQQAhByATIQJBACENIAohBkEAIQ5BACEPA0AgBSAGQQF0ai4BACIIIAAgCUEBdCIQai8BAGwgB2ohByAAIBBBBnJqLwEAIAhsIA5qIQ4gACAQQQRyai8BACAIbCAPaiEPIAAgEEECcmovAQAgCGwgDWohDSAJQQRqIQkgBkEBaiEGIAJBAWsiAg0ACyAHQQd1IQggDUEHdSEJIA9BB3UhBiAKIBNqIQcgDkEHdQtBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKGyIKQf8BcQRAIAlB/wFsIAJtIQkgCEH/AWwgAm0hCCAGQf8BbCACbSEGCyABIAxBAnRqIAlBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EIdEGA/gNxIAZBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EQdEGAgPwHcSAKQRh0ciAIQYBAa0EOdSICQf8BIAJB/wFIGyICQQAgAkEAShtycjYCACADIAxqIQwgEkEBaiISIARHDQALIBQgC0EBaiILbCERIAMgC0cNAAsLC0AAIAcEQEEAIAIgAyAEIAUgABADIAJBACAEIAUgBiABEAQPC0EAIAIgAyAEIAUgABABIAJBACAEIAUgBiABEAIL"},{}],4:[function(C,Q,S){"use strict";Q.exports={name:"resize",fn:C("./resize"),wasm_fn:C("./resize_wasm"),wasm_src:C("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(C,Q,S){"use strict";var E=C("./resize_filter_gen"),B=C("./convolve"),a=B.convolveHor,A=B.convolveVert,i=B.convolveHorWithPre,s=B.convolveVertWithPre;function e(l,n,o){for(var u=3,h=n*o*4|0;u<h;){if(l[u]!==255)return!0;u=u+4|0}return!1}function t(l,n,o){for(var u=3,h=n*o*4|0;u<h;)l[u]=255,u=u+4|0}Q.exports=function(n){var o=n.src,u=n.width,h=n.height,I=n.toWidth,v=n.toHeight,m=n.scaleX||n.toWidth/n.width,b=n.scaleY||n.toHeight/n.height,y=n.offsetX||0,F=n.offsetY||0,d=n.dest||new Uint8Array(I*v*4),p=typeof n.filter=="undefined"?"mks2013":n.filter,x=E(p,u,I,m,y),w=E(p,h,v,b,F),G=new Uint16Array(I*h*4);return e(o,u,h)?(i(o,G,u,h,I,x),s(G,d,h,I,v,w)):(a(o,G,u,h,I,x),A(G,d,h,I,v,w),t(d,I,v)),d}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(C,Q,S){"use strict";var E=C("./resize_filter_info"),B=14;function a(A){return Math.round(A*((1<<B)-1))}Q.exports=function(i,s,e,t,l){var n=E.filter[i].fn,o=1/t,u=Math.min(1,t),h=E.filter[i].win/u,I,v,m,b,y,F,d,p,x,w,G,D,W,U,r,c,f,_=Math.floor((h+1)*2),g=new Int16Array((_+2)*e),R=0,M=!g.subarray||!g.set;for(I=0;I<e;I++){for(v=(I+.5)*o+l,m=Math.max(0,Math.floor(v-h)),b=Math.min(s-1,Math.ceil(v+h)),y=b-m+1,F=new Float32Array(y),d=new Int16Array(y),p=0,x=m,w=0;x<=b;x++,w++)G=n((x+.5-v)*u),p+=G,F[w]=G;for(D=0,w=0;w<F.length;w++)W=F[w]/p,D+=W,d[w]=a(W);for(d[e>>1]+=a(1-D),U=0;U<d.length&&d[U]===0;)U++;if(U<d.length){for(r=d.length-1;r>0&&d[r]===0;)r--;if(c=m+U,f=r-U+1,g[R++]=c,g[R++]=f,!M)g.set(d.subarray(U,r+1),R),R+=f;else for(w=U;w<=r;w++)g[R++]=d[w]}else g[R++]=0,g[R++]=0}return g}},{"./resize_filter_info":7}],7:[function(C,Q,S){"use strict";var E={box:{win:.5,fn:function(a){return a<0&&(a=-a),a<.5?1:0}},hamming:{win:1,fn:function(a){if(a<0&&(a=-a),a>=1)return 0;if(a<11920929e-14)return 1;var A=a*Math.PI;return Math.sin(A)/A*(.54+.46*Math.cos(A/1))}},lanczos2:{win:2,fn:function(a){if(a<0&&(a=-a),a>=2)return 0;if(a<11920929e-14)return 1;var A=a*Math.PI;return Math.sin(A)/A*Math.sin(A/2)/(A/2)}},lanczos3:{win:3,fn:function(a){if(a<0&&(a=-a),a>=3)return 0;if(a<11920929e-14)return 1;var A=a*Math.PI;return Math.sin(A)/A*Math.sin(A/3)/(A/3)}},mks2013:{win:2.5,fn:function(a){return a<0&&(a=-a),a>=2.5?0:a>=1.5?-.125*(a-2.5)*(a-2.5):a>=.5?.25*(4*a*a-11*a+7):1.0625-1.75*a*a}}};Q.exports={filter:E,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(C,Q,S){"use strict";var E=C("./resize_filter_gen");function B(e,t,l){for(var n=3,o=t*l*4|0;n<o;){if(e[n]!==255)return!0;n=n+4|0}return!1}function a(e,t,l){for(var n=3,o=t*l*4|0;n<o;)e[n]=255,n=n+4|0}function A(e){return new Uint8Array(e.buffer,0,e.byteLength)}var i=!0;try{i=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch(e){}function s(e,t,l){if(i){t.set(A(e),l);return}for(var n=l,o=0;o<e.length;o++){var u=e[o];t[n++]=u&255,t[n++]=u>>8&255}}Q.exports=function(t){var l=t.src,n=t.width,o=t.height,u=t.toWidth,h=t.toHeight,I=t.scaleX||t.toWidth/t.width,v=t.scaleY||t.toHeight/t.height,m=t.offsetX||0,b=t.offsetY||0,y=t.dest||new Uint8Array(u*h*4),F=typeof t.filter=="undefined"?"mks2013":t.filter,d=E(F,n,u,I,m),p=E(F,o,h,v,b),x=0,w=Math.max(l.byteLength,y.byteLength),G=this.__align(x+w),D=o*u*4*2,W=this.__align(G+D),U=this.__align(W+d.byteLength),r=U+p.byteLength,c=this.__instance("resize",r),f=new Uint8Array(this.__memory.buffer),_=new Uint32Array(this.__memory.buffer),g=new Uint32Array(l.buffer);_.set(g),s(d,f,W),s(p,f,U);var R=c.exports.convolveHV||c.exports._convolveHV;B(l,n,o)?R(W,U,G,n,o,u,h,1):(R(W,U,G,n,o,u,h,0),a(y,u,h));var M=new Uint32Array(y.buffer);return M.set(new Uint32Array(this.__memory.buffer,0,h*u)),y}},{"./resize_filter_gen":6}],9:[function(C,Q,S){"use strict";Q.exports={name:"unsharp_mask",fn:C("./unsharp_mask"),wasm_fn:C("./unsharp_mask_wasm"),wasm_src:C("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(C,Q,S){"use strict";var E=C("glur/mono16");function B(a,A,i){for(var s=A*i,e=new Uint16Array(s),t,l,n,o,u=0;u<s;u++)t=a[4*u],l=a[4*u+1],n=a[4*u+2],o=t>=l&&t>=n?t:l>=n&&l>=t?l:n,e[u]=o<<8;return e}Q.exports=function(A,i,s,e,t,l){var n,o,u,h,I;if(!(e===0||t<.5)){t>2&&(t=2);var v=B(A,i,s),m=new Uint16Array(v);E(m,i,s,t);for(var b=e/100*4096+.5|0,y=l<<8,F=i*s,d=0;d<F;d++)n=v[d],h=n-m[d],Math.abs(h)>=y&&(o=n+(b*h+2048>>12),o=o>65280?65280:o,o=o<0?0:o,n=n!==0?n:1,u=(o<<12)/n|0,I=d*4,A[I]=A[I]*u+2048>>12,A[I+1]=A[I+1]*u+2048>>12,A[I+2]=A[I+2]*u+2048>>12)}}},{"glur/mono16":18}],11:[function(C,Q,S){"use strict";Q.exports=function(B,a,A,i,s,e){if(!(i===0||s<.5)){s>2&&(s=2);var t=a*A,l=t*4,n=t*2,o=t*2,u=Math.max(a,A)*4,h=32,I=0,v=l,m=v+n,b=m+o,y=b+o,F=y+u,d=this.__instance("unsharp_mask",l+n+o*2+u+h,{exp:Math.exp}),p=new Uint32Array(B.buffer),x=new Uint32Array(this.__memory.buffer);x.set(p);var w=d.exports.hsv_v16||d.exports._hsv_v16;w(I,v,a,A),w=d.exports.blurMono16||d.exports._blurMono16,w(v,m,b,y,F,a,A,s),w=d.exports.unsharp||d.exports._unsharp,w(I,I,v,m,a,A,i,e),p.set(new Uint32Array(this.__memory.buffer,0,t))}}},{}],12:[function(C,Q,S){"use strict";Q.exports="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"},{}],13:[function(C,Q,S){"use strict";var E=100;function B(a,A){this.create=a,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=A||2e3}B.prototype.acquire=function(){var a=this,A;return this.available.length!==0?A=this.available.pop():(A=this.create(),A.id=this.lastId++,A.release=function(){return a.release(A)}),this.acquired[A.id]=A,A},B.prototype.release=function(a){var A=this;delete this.acquired[a.id],a.lastUsed=Date.now(),this.available.push(a),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return A.gc()},E))},B.prototype.gc=function(){var a=this,A=Date.now();this.available=this.available.filter(function(i){return A-i.lastUsed>a.idle?(i.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return a.gc()},E):this.timeoutId=0},Q.exports=B},{}],14:[function(C,Q,S){"use strict";var E=2;Q.exports=function(a,A,i,s,e,t){var l=i/a,n=s/A,o=(2*t+E+1)/e;if(o>.5)return[[i,s]];var u=Math.ceil(Math.log(Math.min(l,n))/Math.log(o));if(u<=1)return[[i,s]];for(var h=[],I=0;I<u;I++){var v=Math.round(Math.pow(Math.pow(a,u-I-1)*Math.pow(i,I+1),1/u)),m=Math.round(Math.pow(Math.pow(A,u-I-1)*Math.pow(s,I+1),1/u));h.push([v,m])}return h}},{}],15:[function(C,Q,S){"use strict";var E=1e-5;function B(A){var i=Math.round(A);return Math.abs(A-i)<E?i:Math.floor(A)}function a(A){var i=Math.round(A);return Math.abs(A-i)<E?i:Math.ceil(A)}Q.exports=function(i){var s=i.toWidth/i.width,e=i.toHeight/i.height,t=B(i.srcTileSize*s)-2*i.destTileBorder,l=B(i.srcTileSize*e)-2*i.destTileBorder;if(t<1||l<1)throw new Error("Internal error in pica: target tile width/height is too small.");var n,o,u,h,I,v,m=[],b;for(h=0;h<i.toHeight;h+=l)for(u=0;u<i.toWidth;u+=t)n=u-i.destTileBorder,n<0&&(n=0),I=u+t+i.destTileBorder-n,n+I>=i.toWidth&&(I=i.toWidth-n),o=h-i.destTileBorder,o<0&&(o=0),v=h+l+i.destTileBorder-o,o+v>=i.toHeight&&(v=i.toHeight-o),b={toX:n,toY:o,toWidth:I,toHeight:v,toInnerX:u,toInnerY:h,toInnerWidth:t,toInnerHeight:l,offsetX:n/s-B(n/s),offsetY:o/e-B(o/e),scaleX:s,scaleY:e,x:B(n/s),y:B(o/e),width:a(I/s),height:a(v/e)},m.push(b);return m}},{}],16:[function(C,Q,S){"use strict";function E(B){return Object.prototype.toString.call(B)}Q.exports.isCanvas=function(a){var A=E(a);return A==="[object HTMLCanvasElement]"||A==="[object OffscreenCanvas]"||A==="[object Canvas]"},Q.exports.isImage=function(a){return E(a)==="[object HTMLImageElement]"},Q.exports.isImageBitmap=function(a){return E(a)==="[object ImageBitmap]"},Q.exports.limiter=function(a){var A=0,i=[];function s(){A<a&&i.length&&(A++,i.shift()())}return function(t){return new Promise(function(l,n){i.push(function(){t().then(function(o){l(o),A--,s()},function(o){n(o),A--,s()})}),s()})}},Q.exports.cib_quality_name=function(a){switch(a){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},Q.exports.cib_support=function(a){return Promise.resolve().then(function(){if(typeof createImageBitmap=="undefined")return!1;var A=a(100,100);return createImageBitmap(A,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(i){var s=i.width===10;return i.close(),A=null,s})}).catch(function(){return!1})},Q.exports.worker_offscreen_canvas_support=function(){return new Promise(function(a,A){if(typeof OffscreenCanvas=="undefined"){a(!1);return}function i(t){if(typeof createImageBitmap=="undefined"){t.postMessage(!1);return}Promise.resolve().then(function(){var l=new OffscreenCanvas(10,10),n=l.getContext("2d");return n.rect(0,0,1,1),createImageBitmap(l,0,0,1,1)}).then(function(){return t.postMessage(!0)},function(){return t.postMessage(!1)})}var s=btoa("(".concat(i.toString(),")(self);")),e=new Worker("data:text/javascript;base64,".concat(s));e.onmessage=function(t){return a(t.data)},e.onerror=A}).then(function(a){return a},function(){return!1})},Q.exports.can_use_canvas=function(a){var A=!1;try{var i=a(2,1),s=i.getContext("2d"),e=s.createImageData(2,1);e.data[0]=12,e.data[1]=23,e.data[2]=34,e.data[3]=255,e.data[4]=45,e.data[5]=56,e.data[6]=67,e.data[7]=255,s.putImageData(e,0,0),e=null,e=s.getImageData(0,0,2,1),e.data[0]===12&&e.data[1]===23&&e.data[2]===34&&e.data[3]===255&&e.data[4]===45&&e.data[5]===56&&e.data[6]===67&&e.data[7]===255&&(A=!0)}catch(t){}return A},Q.exports.cib_can_use_region=function(){return new Promise(function(a){if(typeof Image=="undefined"||typeof createImageBitmap=="undefined"){a(!1);return}var A=new Image;A.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",A.onload=function(){createImageBitmap(A,0,0,A.width,A.height).then(function(i){i.width===A.width&&i.height===A.height?a(!0):a(!1)},function(){return a(!1)})},A.onerror=function(){return a(!1)}})}},{}],17:[function(C,Q,S){"use strict";Q.exports=function(){var E=C("./mathlib"),B;onmessage=function(A){var i=A.data.opts,s=!1;if(!i.src&&i.srcBitmap){var e=new OffscreenCanvas(i.width,i.height),t=e.getContext("2d");t.drawImage(i.srcBitmap,0,0),i.src=t.getImageData(0,0,i.width,i.height).data,e.width=e.height=0,e=null,i.srcBitmap.close(),i.srcBitmap=null}B||(B=new E(A.data.features));var l=B.resizeAndUnsharp(i);if(s){var n=new ImageData(new Uint8ClampedArray(l),i.toWidth,i.toHeight),o=new OffscreenCanvas(i.toWidth,i.toHeight),u=o.getContext("2d");u.putImageData(n,0,0),createImageBitmap(o).then(function(h){postMessage({bitmap:h},[h])})}else postMessage({data:l},[l.buffer])}}},{"./mathlib":1}],18:[function(C,Q,S){var E,B,a,A,i,s,e,t;function l(u){u<.5&&(u=.5);var h=Math.exp(.726*.726)/u,I=Math.exp(-h),v=Math.exp(-2*h),m=(1-I)*(1-I)/(1+2*h*I-v);return E=m,B=m*(h-1)*I,a=m*(h+1)*I,A=-m*v,i=2*I,s=-v,e=(E+B)/(1-i-s),t=(a+A)/(1-i-s),new Float32Array([E,B,a,A,i,s,e,t])}function n(u,h,I,v,m,b){var y,F,d,p,x,w,G,D,W,U,r,c,f,_;for(W=0;W<b;W++){for(w=W*m,G=W,D=0,y=u[w],x=y*v[6],p=x,r=v[0],c=v[1],f=v[4],_=v[5],U=0;U<m;U++)F=u[w],d=F*r+y*c+p*f+x*_,x=p,p=d,y=F,I[D]=p,D++,w++;for(w--,D--,G+=b*(m-1),y=u[w],x=y*v[7],p=x,F=y,r=v[2],c=v[3],U=m-1;U>=0;U--)d=F*r+y*c+p*f+x*_,x=p,p=d,y=F,F=u[w],h[G]=I[D]+p,w--,D--,G-=b}}function o(u,h,I,v){if(v){var m=new Uint16Array(u.length),b=new Float32Array(Math.max(h,I)),y=l(v);n(u,m,b,y,h,I,v),n(m,u,b,y,I,h,v)}}Q.exports=o},{}],19:[function(C,Q,S){"use strict";var E=C("object-assign"),B=C("./lib/base64decode"),a=C("./lib/wa_detect"),A={js:!0,wasm:!0};function i(s){if(!(this instanceof i))return new i(s);var e=E({},A,s||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}i.prototype.has_wasm=a,i.prototype.use=function(s){return this.__modules[s.name]=s,this.options.wasm&&this.has_wasm()&&s.wasm_fn?this[s.name]=s.wasm_fn:this[s.name]=s.fn,this},i.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var s=this;return this.__init_promise=Promise.all(Object.keys(s.__modules).map(function(e){var t=s.__modules[e];return!s.options.wasm||!s.has_wasm()||!t.wasm_fn||s.__wasm[e]?null:WebAssembly.compile(s.__base64decode(t.wasm_src)).then(function(l){s.__wasm[e]=l})})).then(function(){return s}),this.__init_promise},i.prototype.__base64decode=B,i.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/(64*1024))}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/(64*1024))),this.__memory},i.prototype.__instance=function(e,t,l){if(t&&this.__reallocate(t),!this.__wasm[e]){var n=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[e]){var o={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:E(o,l||{})})}return this.__cache[e]},i.prototype.__align=function(e,t){t=t||8;var l=e%t;return e+(l?t-l:0)},Q.exports=i},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(C,Q,S){"use strict";var E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Q.exports=function(a){for(var A=a.replace(/[\r\n=]/g,""),i=A.length,s=new Uint8Array(i*3>>2),e=0,t=0,l=0;l<i;l++)l%4===0&&l&&(s[t++]=e>>16&255,s[t++]=e>>8&255,s[t++]=e&255),e=e<<6|E.indexOf(A.charAt(l));var n=i%4*6;return n===0?(s[t++]=e>>16&255,s[t++]=e>>8&255,s[t++]=e&255):n===18?(s[t++]=e>>10&255,s[t++]=e>>2&255):n===12&&(s[t++]=e>>4&255),s}},{}],21:[function(C,Q,S){"use strict";var E;Q.exports=function(){if(typeof E!="undefined"||(E=!1,typeof WebAssembly=="undefined"))return E;try{var a=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),A=new WebAssembly.Module(a),i=new WebAssembly.Instance(A,{});return i.exports.test(4)!==0&&(E=!0),E}catch(s){}return E}},{}],22:[function(C,Q,S){"use strict";var E=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function A(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function i(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var l=Object.getOwnPropertyNames(e).map(function(o){return e[o]});if(l.join("")!=="0123456789")return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(o){n[o]=o}),Object.keys(Object.assign({},n)).join("")==="abcdefghijklmnopqrst"}catch(o){return!1}}Q.exports=i()?Object.assign:function(s,e){for(var t,l=A(s),n,o=1;o<arguments.length;o++){t=Object(arguments[o]);for(var u in t)B.call(t,u)&&(l[u]=t[u]);if(E){n=E(t);for(var h=0;h<n.length;h++)a.call(t,n[h])&&(l[n[h]]=t[n[h]])}}return l}},{}],23:[function(C,Q,S){var E=arguments[3],B=arguments[4],a=arguments[5],A=JSON.stringify;Q.exports=function(i,s){for(var e,t=Object.keys(a),l=0,n=t.length;l<n;l++){var o=t[l],u=a[o].exports;if(u===i||u&&u.default===i){e=o;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},l=0,n=t.length;l<n;l++){var o=t[l];h[o]=o}B[e]=["function(require,module,exports){"+i+"(self); }",h]}var I=Math.floor(Math.pow(16,8)*Math.random()).toString(16),v={};v[e]=e,B[I]=["function(require,module,exports){var f = require("+A(e)+");(f.default ? f.default : f)(self);}",v];var m={};b(I);function b(w){m[w]=!0;for(var G in B[w][1]){var D=B[w][1][G];m[D]||b(D)}}var y="("+E+")({"+Object.keys(m).map(function(w){return A(w)+":["+B[w][0]+","+A(B[w][1])+"]"}).join(",")+"},{},["+A(I)+"])",F=window.URL||window.webkitURL||window.mozURL||window.msURL,d=new Blob([y],{type:"text/javascript"});if(s&&s.bare)return d;var p=F.createObjectURL(d),x=new Worker(p);return x.objectURL=p,x}},{}],"/index.js":[function(C,Q,S){"use strict";function E(r,c){return s(r)||i(r,c)||a(r,c)||B()}function B(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a(r,c){if(r){if(typeof r=="string")return A(r,c);var f=Object.prototype.toString.call(r).slice(8,-1);if(f==="Object"&&r.constructor&&(f=r.constructor.name),f==="Map"||f==="Set")return Array.from(r);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return A(r,c)}}function A(r,c){(c==null||c>r.length)&&(c=r.length);for(var f=0,_=new Array(c);f<c;f++)_[f]=r[f];return _}function i(r,c){var f=r==null?null:typeof Symbol!="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(f!=null){var _=[],g=!0,R=!1,M,k;try{for(f=f.call(r);!(g=(M=f.next()).done)&&(_.push(M.value),!(c&&_.length===c));g=!0);}catch(O){R=!0,k=O}finally{try{!g&&f.return!=null&&f.return()}finally{if(R)throw k}}return _}}function s(r){if(Array.isArray(r))return r}var e=C("object-assign"),t=C("webworkify"),l=C("./lib/mathlib"),n=C("./lib/pool"),o=C("./lib/utils"),u=C("./lib/worker"),h=C("./lib/stepper"),I=C("./lib/tiler"),v=C("./lib/mm_resize/resize_filter_info"),m={},b=!1;try{typeof navigator!="undefined"&&navigator.userAgent&&(b=navigator.userAgent.indexOf("Safari")>=0)}catch(r){}var y=1;typeof navigator!="undefined"&&(y=Math.min(navigator.hardwareConcurrency||1,4));var F={tile:1024,concurrency:y,features:["js","wasm","ww"],idle:2e3,createCanvas:function(c,f){var _=document.createElement("canvas");return _.width=c,_.height=f,_}},d={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},p=!1,x=!1,w=!1,G=!1,D=!1;function W(){return{value:t(u),destroy:function(){if(this.value.terminate(),typeof window!="undefined"){var c=window.URL||window.webkitURL||window.mozURL||window.msURL;c&&c.revokeObjectURL&&this.value.objectURL&&c.revokeObjectURL(this.value.objectURL)}}}}function U(r){if(!(this instanceof U))return new U(r);this.options=e({},F,r||{});var c="lk_".concat(this.options.concurrency);this.__limit=m[c]||o.limiter(this.options.concurrency),m[c]||(m[c]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}U.prototype.init=function(){var r=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData!="undefined"&&typeof Uint8ClampedArray!="undefined")try{new ImageData(new Uint8ClampedArray(400),10,10),p=!0}catch(O){}typeof ImageBitmap!="undefined"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?x=!0:this.debug("ImageBitmap does not support .close(), disabled"));var c=this.options.features.slice();if(c.indexOf("all")>=0&&(c=["cib","wasm","js","ww"]),this.__requested_features=c,this.__mathlib=new l(c),c.indexOf("ww")>=0&&typeof window!="undefined"&&"Worker"in window)try{var f=C("webworkify")(function(){});f.terminate(),this.features.ww=!0;var _="wp_".concat(JSON.stringify(this.options));m[_]?this.__workersPool=m[_]:(this.__workersPool=new n(W,this.options.idle),m[_]=this.__workersPool)}catch(O){}var g=this.__mathlib.init().then(function(O){e(r.features,O.features)}),R;x?R=o.cib_support(this.options.createCanvas).then(function(O){if(r.features.cib&&c.indexOf("cib")<0){r.debug("createImageBitmap() resize supported, but disabled by config");return}c.indexOf("cib")>=0&&(r.features.cib=O)}):R=Promise.resolve(!1),w=o.can_use_canvas(this.options.createCanvas);var M;x&&p&&c.indexOf("ww")!==-1?M=o.worker_offscreen_canvas_support():M=Promise.resolve(!1),M=M.then(function(O){G=O});var k=o.cib_can_use_region().then(function(O){D=O});return this.__initPromise=Promise.all([g,R,M,k]).then(function(){return r}),this.__initPromise},U.prototype.__invokeResize=function(r,c){var f=this;return c.__mathCache=c.__mathCache||{},Promise.resolve().then(function(){return f.features.ww?new Promise(function(_,g){var R=f.__workersPool.acquire();c.cancelToken&&c.cancelToken.catch(function(k){return g(k)}),R.value.onmessage=function(k){R.release(),k.data.err?g(k.data.err):_(k.data)};var M=[];r.src&&M.push(r.src.buffer),r.srcBitmap&&M.push(r.srcBitmap),R.value.postMessage({opts:r,features:f.__requested_features,preload:{wasm_nodule:f.__mathlib.__}},M)}):{data:f.__mathlib.resizeAndUnsharp(r,c.__mathCache)}})},U.prototype.__extractTileData=function(r,c,f,_,g){if(this.features.ww&&G&&(o.isCanvas(c)||D))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(_.srcImageBitmap||c,r.x,r.y,r.width,r.height).then(function(k){return g.srcBitmap=k,g});if(o.isCanvas(c))return _.srcCtx||(_.srcCtx=c.getContext("2d")),this.debug("Get tile pixel data"),g.src=_.srcCtx.getImageData(r.x,r.y,r.width,r.height).data,g;this.debug("Draw tile imageBitmap/image to temporary canvas");var R=this.options.createCanvas(r.width,r.height),M=R.getContext("2d");return M.globalCompositeOperation="copy",M.drawImage(_.srcImageBitmap||c,r.x,r.y,r.width,r.height,0,0,r.width,r.height),this.debug("Get tile pixel data"),g.src=M.getImageData(0,0,r.width,r.height).data,R.width=R.height=0,g},U.prototype.__landTileData=function(r,c,f){var _;if(this.debug("Convert raw rgba tile result to ImageData"),c.bitmap)return f.toCtx.drawImage(c.bitmap,r.toX,r.toY),null;if(p)_=new ImageData(new Uint8ClampedArray(c.data),r.toWidth,r.toHeight);else if(_=f.toCtx.createImageData(r.toWidth,r.toHeight),_.data.set)_.data.set(c.data);else for(var g=_.data.length-1;g>=0;g--)_.data[g]=c.data[g];return this.debug("Draw tile"),b?f.toCtx.putImageData(_,r.toX,r.toY,r.toInnerX-r.toX,r.toInnerY-r.toY,r.toInnerWidth+1e-5,r.toInnerHeight+1e-5):f.toCtx.putImageData(_,r.toX,r.toY,r.toInnerX-r.toX,r.toInnerY-r.toY,r.toInnerWidth,r.toInnerHeight),null},U.prototype.__tileAndResize=function(r,c,f){var _=this,g={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},R=function(k){return _.__limit(function(){if(f.canceled)return f.cancelToken;var O={width:k.width,height:k.height,toWidth:k.toWidth,toHeight:k.toHeight,scaleX:k.scaleX,scaleY:k.scaleY,offsetX:k.offsetX,offsetY:k.offsetY,filter:f.filter,unsharpAmount:f.unsharpAmount,unsharpRadius:f.unsharpRadius,unsharpThreshold:f.unsharpThreshold};return _.debug("Invoke resize math"),Promise.resolve(O).then(function(j){return _.__extractTileData(k,r,f,g,j)}).then(function(j){return _.debug("Invoke resize math"),_.__invokeResize(j,f)}).then(function(j){return f.canceled?f.cancelToken:(g.srcImageData=null,_.__landTileData(k,j,g))})})};return Promise.resolve().then(function(){if(g.toCtx=c.getContext("2d"),o.isCanvas(r))return null;if(o.isImageBitmap(r))return g.srcImageBitmap=r,g.isImageBitmapReused=!0,null;if(o.isImage(r))return x?(_.debug("Decode image via createImageBitmap"),createImageBitmap(r).then(function(M){g.srcImageBitmap=M}).catch(function(M){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(f.canceled)return f.cancelToken;_.debug("Calculate tiles");var M=I({width:f.width,height:f.height,srcTileSize:_.options.tile,toWidth:f.toWidth,toHeight:f.toHeight,destTileBorder:f.__destTileBorder}),k=M.map(function(j){return R(j)});function O(j){j.srcImageBitmap&&(j.isImageBitmapReused||j.srcImageBitmap.close(),j.srcImageBitmap=null)}return _.debug("Process tiles"),Promise.all(k).then(function(){return _.debug("Finished!"),O(g),c},function(j){throw O(g),j})})},U.prototype.__processStages=function(r,c,f,_){var g=this;if(_.canceled)return _.cancelToken;var R=r.shift(),M=E(R,2),k=M[0],O=M[1],j=r.length===0,T;j||v.q2f.indexOf(_.filter)<0?T=_.filter:_.filter==="box"?T="box":T="hamming",_=e({},_,{toWidth:k,toHeight:O,filter:T});var q;return j||(q=this.options.createCanvas(k,O)),this.__tileAndResize(c,j?f:q,_).then(function(){return j?f:(_.width=k,_.height=O,g.__processStages(r,q,f,_))}).then(function(V){return q&&(q.width=q.height=0),V})},U.prototype.__resizeViaCreateImageBitmap=function(r,c,f){var _=this,g=c.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(r,{resizeWidth:f.toWidth,resizeHeight:f.toHeight,resizeQuality:o.cib_quality_name(v.f2q[f.filter])}).then(function(R){if(f.canceled)return f.cancelToken;if(!f.unsharpAmount)return g.drawImage(R,0,0),R.close(),g=null,_.debug("Finished!"),c;_.debug("Unsharp result");var M=_.options.createCanvas(f.toWidth,f.toHeight),k=M.getContext("2d");k.drawImage(R,0,0),R.close();var O=k.getImageData(0,0,f.toWidth,f.toHeight);return _.__mathlib.unsharp_mask(O.data,f.toWidth,f.toHeight,f.unsharpAmount,f.unsharpRadius,f.unsharpThreshold),g.putImageData(O,0,0),M.width=M.height=0,O=k=M=g=null,_.debug("Finished!"),c})},U.prototype.resize=function(r,c,f){var _=this;this.debug("Start resize...");var g=e({},d);if(isNaN(f)?f&&(g=e(g,f)):g=e(g,{quality:f}),g.toWidth=c.width,g.toHeight=c.height,g.width=r.naturalWidth||r.width,g.height=r.naturalHeight||r.height,Object.prototype.hasOwnProperty.call(g,"quality")){if(g.quality<0||g.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(g.quality));g.filter=v.q2f[g.quality]}if(c.width===0||c.height===0)return Promise.reject(new Error("Invalid output size: ".concat(c.width,"x").concat(c.height)));g.unsharpRadius>2&&(g.unsharpRadius=2),g.canceled=!1,g.cancelToken&&(g.cancelToken=g.cancelToken.then(function(M){throw g.canceled=!0,M},function(M){throw g.canceled=!0,M}));var R=3;return g.__destTileBorder=Math.ceil(Math.max(R,2.5*g.unsharpRadius|0)),this.init().then(function(){if(g.canceled)return g.cancelToken;if(_.features.cib){if(v.q2f.indexOf(g.filter)>=0)return _.__resizeViaCreateImageBitmap(r,c,g);_.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!w){var M=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw M.code="ERR_GET_IMAGE_DATA",M}var k=h(g.width,g.height,g.toWidth,g.toHeight,_.options.tile,g.__destTileBorder);return _.__processStages(k,r,c,g)})},U.prototype.resizeBuffer=function(r){var c=this,f=e({},d,r);if(Object.prototype.hasOwnProperty.call(f,"quality")){if(f.quality<0||f.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(f.quality));f.filter=v.q2f[f.quality]}return this.init().then(function(){return c.__mathlib.resizeAndUnsharp(f)})},U.prototype.toBlob=function(r,c,f){return c=c||"image/png",new Promise(function(_){if(r.toBlob){r.toBlob(function(O){return _(O)},c,f);return}if(r.convertToBlob){_(r.convertToBlob({type:c,quality:f}));return}for(var g=atob(r.toDataURL(c,f).split(",")[1]),R=g.length,M=new Uint8Array(R),k=0;k<R;k++)M[k]=g.charCodeAt(k);_(new Blob([M],{type:c}))})},U.prototype.debug=function(){},Q.exports=U},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})});var fe={};ie(fe,{default:()=>oe});var K=ne(Z(),1),oe=K.default;return se(fe);})();
/*! Bundled license information:

pica/dist/pica.js:
  (*!
  
  pica
  https://github.com/nodeca/pica
  
  *)
  (*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  *)
*/
//# sourceMappingURL=pica.iife.min.js.map
